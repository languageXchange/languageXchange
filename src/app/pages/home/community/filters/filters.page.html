<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button (click)="resetFilter()" expand="block" size="large" slot="icon-only" shape="round">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="onSubmit()" expand="block" size="large" slot="icon-only" shape="round" color="primary">
        <ion-icon name="checkmark-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Filters</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
    
    <ion-card>
      <ion-card-header>
        <ion-card-title>Languages</ion-card-title>
      </ion-card-header>
    
      <ion-card-content class="hasIcon">
        <ion-item *ngFor="let lang of currentUserData?.studyLanguages" >
          <ion-icon *ngIf="lang.level == 1" name="battery-dead-outline"></ion-icon>
          <ion-icon *ngIf="lang.level == 2" name="battery-half-outline"></ion-icon>
          <ion-icon *ngIf="lang.level == 3" name="battery-full-outline"></ion-icon>
          <ion-checkbox labelPlacement="start" color="primary" [checked]="isCheckedLanguage(lang?.code)" (ionChange)="languageChecked($event, lang?.code)">{{ lang?.name }}</ion-checkbox>
        </ion-item>
      </ion-card-content>
    </ion-card>


    <ion-card>
      <ion-card-header>
        <ion-card-title>County</ion-card-title>
      </ion-card-header>
    
      <ion-card-content class="hasIcon">
        <ion-item id="country-modal" detail="true">
          <ion-icon name="flag-outline"></ion-icon>
          <ion-label>
            <h3 *ngIf="showCountry();else noFilter">{{showCountry()}}</h3>
            <ng-template #noFilter><p>No Filter</p></ng-template> 
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Gender</ion-card-title>
      </ion-card-header>
    
      <ion-card-content class="hasIcon">
        <ion-item id="gender-modal" detail="true">
          <ion-icon name="male-female-outline"></ion-icon>
          <ion-label>
            <h3 *ngIf="showGender();else noFilter">{{showGender()}}</h3>
            <ng-template #noFilter><p>No Filter</p></ng-template> 
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Age</ion-card-title>
      </ion-card-header>
    
      <ion-card-content class="hasIcon">
        <ion-item>
          <ion-icon name="calendar-number-outline"></ion-icon>
          <ion-label>
            <h3 *ngIf="showAge();else noFilter">{{showAge()}}</h3>
            <ng-template #noFilter><p>No Filter</p></ng-template>
          </ion-label>
        </ion-item>
        <ion-range
          (ionChange)="ageChange($event)"
          [dualKnobs]="true"
          [pin]="true"
          [min]="13"
          [max]="85"
          [value]="ionRangeDefault">
        </ion-range>
      </ion-card-content>
    </ion-card>

    <ion-row>
      <ion-col>
        <ion-button *ngIf="!isLoading" type="submit" color="primary" (click)="onSubmit()" expand="block">Apply</ion-button>
        <ion-button *ngIf="isLoading" color="primary" expand="block" disabled>
          <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
        </ion-button>
      </ion-col>
    </ion-row>

</ion-content>

<!------------------>
<!-- MODALS start -->
<!------------------>

<ion-modal #genderModal class="modalClass" trigger="gender-modal" [initialBreakpoint]="1" [breakpoints]="[0, 1]">
  <div class="block">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Gender</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="genderModal.dismiss()" color="primary">Confirm</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-radio-group (ionChange)="genderChange($event)" [value]="gender">
        <ion-list>
          <ion-item>
            <ion-radio value="male">Male</ion-radio><br />
          </ion-item>          
          <ion-item>
            <ion-radio value="female">Female</ion-radio><br />
          </ion-item>          
          <ion-item>
            <ion-radio value="other">Other</ion-radio>
          </ion-item>          
        </ion-list>
      </ion-radio-group>
    </ng-template>
  </div>
</ion-modal>

<ion-modal
  #countryModal
  trigger="country-modal"
  [initialBreakpoint]="0.5"
  [breakpoints]="[0.25, 0.5, 0.75]"
>
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Country</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="countryModal.dismiss()" color="primary">Confirm</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-searchbar [(ngModel)]="searchTerm" placeholder="Search" (click)="countryModal.setCurrentBreakpoint(0.75)"></ion-searchbar>
      <ion-list>
        <ion-radio-group value="start" (ionChange)="countryChange($event)">
          <ion-item *ngFor="let country of countryData | customFilter: searchTerm">
            <ion-radio value="{{ country?.value }}" labelPlacement="start">{{ country?.text }}</ion-radio>
          </ion-item>
        </ion-radio-group>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-modal>